function renderLatex() {
    let urlParams = new URLSearchParams(window.location.search);
    let latex = decodeLatex(urlParams.get("latex"));

    // 🔍 Mostrar la ecuación antes de renderizarla para depuración
    console.log("Ecuación recibida:", latex);
    document.body.insertAdjacentHTML('beforeend', `<p style="color: green;">🔍 Ecuación recibida antes de renderizar: ${latex}</p>`);

    if (!latex) {
        document.getElementById("latexOutput").innerHTML = "⚠️ No se recibió ninguna ecuación.";
        sendMessageToThunkable("No se recibió ninguna ecuación.");
        return;
    }

    try {
        document.getElementById("latexOutput").innerHTML = "";

        // 🔹 Asegurar que KaTeX reciba correctamente la ecuación
        let formattedLatex = `\\[${latex}\\]`;

        katex.render(formattedLatex, document.getElementById("latexOutput"), { throwOnError: false, displayMode: true });

        sendMessageToThunkable("Ecuación renderizada correctamente");
    } catch (error) {
        console.error("Error al renderizar KaTeX:", error);
        document.getElementById("latexOutput").innerHTML = "⚠️ Error en la ecuación, revisa la sintaxis.";
        sendMessageToThunkable("Error al renderizar LaTeX");
    }
}
