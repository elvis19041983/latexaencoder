<!DOCTYPE html>
<html>
<head>
  <script>
    function encodeLatex() {
      let urlParams = new URLSearchParams(window.location.search);
      let latex = urlParams.get("latex");

      if (!latex) {
        document.getElementById("output").innerText = "‚ùå Error: No se encontr√≥ el par√°metro 'latex'.";
        return;
      }

      // Codificar correctamente el LaTeX
      let encodedLatex = encodeURIComponent(latex);

      // Generar la URL de la imagen con Codecogs
      let imgUrl = "https://latex.codecogs.com/png.latex?" + encodedLatex;

      // Mostrar la URL generada en pantalla para depuraci√≥n
      document.getElementById("output").innerText = "‚úÖ URL de la imagen: " + imgUrl;

      // Mostrar la imagen en pantalla
      let imgElement = document.getElementById("latexImage");
      imgElement.src = imgUrl;

      // Si hay un error al cargar la imagen, mostrar un mensaje
      imgElement.onerror = function() {
        document.getElementById("output").innerText = "‚ùå Error al cargar la imagen.";
      };

      // Esperar un poco antes de enviar la URL a Thunkable
      setTimeout(function () {
        if (window.ReactNativeWebView) {
          document.getElementById("postMsgStatus").innerText = "üì§ Enviando a Thunkable...";
          window.ReactNativeWebView.postMessage(imgUrl);
        } else {
          document.getElementById("postMsgStatus").innerText = "‚ö†Ô∏è `postMessage` no est√° disponible.";
        }
      }, 2000);
    }

    window.onload = encodeLatex;
  </script>
</head>
<body>
  <p id="output">‚åõ Esperando mensaje...</p>
  <p id="postMsgStatus"></p>
  <img id="latexImage" alt="Cargando imagen..." />
</body>
</html>
